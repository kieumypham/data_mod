@device.alarm
@ECO-9545
@ECO-13276

Feature:
  (ECO-9545) As a clinical user,
  I would like to access historical alarm logs for my patients once they are made available in AirView
  so that I can manage my patients better.

  (@ECO-10173) As a clinical user
  I want to add a Astral 100 device to a patient
  so that I can monitor my patient's therapy.

  (ECO-13276) As the Machine Portal,
   I want to update a Suspended Cellular Module state to Activated when a message is received
   so that I known when the last communication occurred


  # ACCEPTANCE CRITERIA: (ECO-9545)
  # Note 1: This story applies to devices with a subscription for alarm logs and alarm settings.
  # Note 2: Alarm logs will only be sent via CAM. There will be no upload of Alarm logs from SD card.
  # Note 3: For data items relating to alarm logs and alarm related settings, please refer to https://objective.resmedglobal.com/id:A2590135/document/versions/17.4 or see attached Excel workbook.
  # 1. AirView shall be able to accept alarm logs information sent via CAM.
  # 2. AirView shall store the alarm logs to the HI Cloud.
  # 3. AirView shall be able to accept alarm settings sent via CAM.
  # 4. AirView shall store the alarm settings to the HI Cloud.
  # Note 5: Information relating to Alarm Logs will include the date and time when alarm ends, the action which indicates whether the alarms was activated or deactivated and the alarm type.
  # Note 6: For the JSON response, see http://jirapd.corp.resmed.org/browse/NDC-1862.
  # Note 7: At the time of writing this story, only VIDs 45 and 46 support the alarm log and alarm settings subscriptions and as such should be tested by V&V.

  # ACCEPTANCE CRITERIA: (ECO-10173)
  #  Note 1: For supported data items refer to https://objective.resmedglobal.com/id:A2590135/document/versions/19.5 or see attached Excel workbook.
  #  Note 2: CAL metadata needs to be updated for this VID using the attached xml. See ECO-6726.
  #  Note 3: CamSim should be updated as per ECO-10545.
  #  Note 4: Astral USB MSD will not be supported in AirView. Only wireless data is available for Astral devices.
  #  Note 5: The default mode for this device is ACV.
  #  Note 6: This VID supports 2 programs and as such data for both programs will eventually need to be requested and stored.  However, for the purposes of this card, ignore the programs and just receive data for the single program.  Also, for the purposes of this card, the program number does not need to be stored in the database.
  #
  #  1. Users shall be able to add an Astral 100 (MID30, VID5) to new or existing patients and receive data from the device as per ECO-7292.
  #
  #  Note 7: Normally, product display name is specified however it is now expected that the name displayed is read off the device (node PNA).  Default name for this variant is Astral 100.
  #  Note 8: US Product Code is 27007 and EU Product Code 27011.
  #  Note 9: Device image is attached.
  #
  #  2. Users shall be able to generate excel exports for an Astral 100 (MID30, VID5) device as per ECO-7295.
  #  3. Incoming data from an Astral 100 (MID30, VID5) device shall be validated as per ECO-7296.
  #
  #  Note 10: Astral devices do NOT support settings changes. Hiding the settings change links is covered in ECO-10499.
  #  Note 11: Incoming alarm logs from Astral 100 (MID30, VID5) device will be stored as per ECO-9545.
  #  Note 12: Incoming alarm related settings from Astral 100 (MID 30, VID5) device will be stored as per ECO-9545.
  #  Note 13: The ACs in the generic stories (ECO-7292 - ECO-7296) have been updated to reflect the Lumis, Stellar and Astral platforms. These ACs will need to be updated in feature files where they are present.

  # ACCEPTANCE CRITERIA: (ECO-13276)
  # A Suspended Cellular Module will be updated to Activated when:
  # 1. A Registration is received
  # 2. An Alarm Setting is received
  # 3. A Climate Setting is received
  # 4. A Device Alarm is received
  # 5. A Device Erasure is received
  # 6. A Device Fault is received
  # 7. A Device Log is received
  # 8. A Settings Event is received
  # 9. A System Event is received
  # 10. A Therapy Detail is received
  # 11. A Therapy Setting is received
  # 12. A Therapy Summary is received

   Background:
      Given the server bulk load the following devices and modules
         | /data/manufacturing/batch_new_fg2007_cam2007.xml |
      And manufacture verify the status of the job
         | status           |
         | COMPLETE-SUCCESS |
      And the following units are cached for local use
         | flowGeneratorSerialNumber | communicationModuleSerialNumber |
         | 20070811225               | 20070811225                     |
      And I am a device with the FlowGen serial number "20070811225"
      And I send the following registration
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
         | { "FG": {"SerialNo": "20070811225", "Software": "SX567-0302", "MID": 36, "VID": 25, "PCBASerialNo": "(90)R370-7341(91)2(21)4Z242783", "ProductCode": "37036", "Configuration": "CX036-025-013-024-102-100-100" }, "CAM": {"SerialNo": "20070811225", "Software": "SX558-0308", "PCBASerialNo": "13152G00010", "Subscriptions": [ "E9D6C89A-D54B-4ABD-81C9-2D7EB4F14806", "F9076939-08A3-4717-A93B-953C806DD58B", "30B59434-BF4F-4788-9678-A00FF860C038", "301E6C6C-A3C3-44B9-99D4-171A99FE6BD5", "51960EDB-EA97-4A50-A32C-EACF6239EBE3", "40326F7E-FE53-4D4B-8D7A-51DCC68F1177", "018A5655-81C6-4888-A2AD-6480087BE395", "2896C763-FE94-4B3F-AD6C-305583FD4210", "21C219CD-EB66-43E7-B677-50E858BB851B", "28D54873-A79C-47A5-A08F-D55D979418F0", "23268714-645A-4A38-85C3-AE691D62907A", "2B04744B-1676-42DE-97ED-199205723183", "24208A76-16A4-427E-BBCF-149A49D9623E", "24208A76-16A4-427E-BBCF-179A49D9718B", "24208A76-16A4-427E-BBCF-179A49D3564C", "2C7CF86E-4E4C-4AEF-97D1-407D23FA9245", "2DD86205-45B5-4023-84D6-40772455902C", "2E30A610-741A-465D-AF65-299CD62BBB1A", "2FADA80D-8094-491C-9481-3CCC471F0372", "12A64E97-6E6F-4C18-A78D-7844A827BF28", "12CE1A82-93A9-4839-948A-E3F8FD51C9FE", "1C166B19-01FA-4D7D-A825-A25682C7CB0C", "1D1771B2-890B-4576-8863-FC8559C03040" ] }, "Hum": {"Software": "SX556-0203"} } |

  @device.alarm.S1
  @ECO-9545.1 @ECO-9545.2
   Scenario: Store device alarm data for multiple session dates
      Given these devices have the following device alarms
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "2 days ago", "CollectTime": "1 days ago 112039", "Val.AlarmEvent": [ { "EndDateTime": "2 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "2 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "2 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "2 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "2 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "2 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "2 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "2 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "1 day ago",  "CollectTime": "today      094703", "Val.AlarmEvent": [ { "EndDateTime": "1 day ago T22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "1 day ago T22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "1 day ago T12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "1 day ago T12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "1 day ago T03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "1 day ago T03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "1 day ago T04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "1 day ago T04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } }  }] } |
      When I send the device alarms from 3 days ago
      Then I should receive a server ok response
      And the following device data received events have been published
         | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      When I send the device alarms from 2 days ago
      Then I should receive a server ok response
      And the following device data received events have been published
         | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "2 days ago", "CollectTime": "1 days ago 112039", "Val.AlarmEvent": [ { "EndDateTime": "2 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "2 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "2 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "2 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "2 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "2 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "2 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "2 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      When I send the device alarms from 1 days ago
      Then I should receive a server ok response
      And the following device data received events have been published
         | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "1 day ago",  "CollectTime": "today      094703", "Val.AlarmEvent": [ { "EndDateTime": "1 day ago T22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "1 day ago T22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "1 day ago T12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "1 day ago T12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "1 day ago T03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "1 day ago T03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "1 day ago T04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "1 day ago T04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } }  }] } |
      Then the following device alarms are stored in the cloud
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "2 days ago", "CollectTime": "1 days ago 112039", "Val.AlarmEvent": [ { "EndDateTime": "2 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "2 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "2 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "2 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "2 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "2 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "2 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "2 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "1 day ago",  "CollectTime": "today      094703", "Val.AlarmEvent": [ { "EndDateTime": "1 day ago T22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "1 day ago T22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "1 day ago T12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "1 day ago T12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "1 day ago T03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "1 day ago T03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "1 day ago T04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "1 day ago T04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } }  }] } |

  @device.alarm.S2
  @ECO-9545.1 @ECO-9545.2
   Scenario: Store device alarm data for single session date, multiple collect times
      When I send the following device alarms
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |
      Then the following device data received events have been published
         | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |
      When I send the following device alarms
        | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
        | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 141302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      Then the following device data received events have been published
        | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
        | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 141302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      And the following device alarms are stored in the cloud
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 141302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |

  @device.alarm.S3
  @ECO-9545.1 @ECO-9545.2
   Scenario: Device alarm with same serial number, session date, and collect time but unique JSON gets logged
      When I send the following device alarms
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |
      Then the following device data received events have been published
         | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |
      And the following device alarms are stored in the cloud
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |
      When I send the following device alarms
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      Then the server should log the following device data received error
         | PersistenceVetoPoint           | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | DUPLICATE_KEY_UNIQUE_CONTENT   | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      And no device data received events have been published
      And the following device alarms are stored in the cloud
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |

  @device.alarm.S4
  @ECO-9545.1 @ECO-9545.2
   Scenario: Device alarm with same serial number, session date, collect time, and JSON does not get logged
      When I send the following device alarms
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      Then the following device data received events have been published
         | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
         | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      And the following device alarms are stored in the cloud
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      When I send the following device alarms
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      Then the server should not log a device data received error
      And no device data received events have been published
      And the following device alarms are stored in the cloud
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |

   @device.alarm.S5
   @ECO-10173.3
   Scenario: Accepting device alarm data from Astral 100 requires ThresholdType allowed to be optional
      When I send the following device alarms
         | json                                                                                                                                                                                                                                                                                                             |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": {}}] } |
      Then the following device data received events have been published
         | JMSType                        | JMSXGroupID | DeviceDataSource | DeviceFlowGenSerialNumber | DeviceMetadataIdentifier | DeviceVariantIdentifier | json                                                                                                                                                          |
         | DEVICE_ALARM                   | 20070811225 | DEVICE           | 20070811225               | 36                       | 25                      | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold":{}}] } |
      And the following device alarms are stored in the cloud
         | json                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold":{}}] } |

   @device.alarm.S6
   @ECO-13276.4
   Scenario: Device alarm event from a suspended device should change status to active
      Given the communication module with serial number "20070811225" has suspended status for 1 days
      When I send the following device alarms
         | json                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 140302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }                                                                                                                                                                                                                                                                 ] } |
         | { "FG.SerialNo": "20070811225", "SubscriptionId": "F9076939-08A3-4717-A93B-953C806DD58B", "Date": "3 days ago", "CollectTime": "2 days ago 141302", "Val.AlarmEvent": [ { "EndDateTime": "3 days agoT22:31:34", "Action": "Activate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT22:31:40", "Action": "Deactivate", "AlarmType": "ApneaAlarm", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "ApneaAlarmThreshold" } }, { "EndDateTime": "3 days agoT12:56:24", "Action": "Activate", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT12:59:40", "Action": "Reset", "AlarmType": "LowMinuteVentilation", "AlarmPriority": "Medium", "Threshold": { "ThresholdType": "LowMinuteVentAlarmThreshold", "Trigger": { "Value": 150.0, "Units": "L/min" } } }, { "EndDateTime": "3 days agoT03:41:00", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "30", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT03:41:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "31", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown" } }, { "EndDateTime": "3 days agoT04:40:04", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_420", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } }, { "EndDateTime": "3 days agoT04:40:05", "Action": "Unknown", "AlarmType": "Unknown", "AlarmCode": "A_421", "AlarmPriority": "Unknown", "Threshold": { "ThresholdType": "Unknown", "ThresholdCode": "S_120", "Trigger": { "Value": 89, "Units": "Unknown" } } } ] } |
      Then the communication module with serial number "20070811225" should eventually have a status of "ACTIVE" within 5 seconds
